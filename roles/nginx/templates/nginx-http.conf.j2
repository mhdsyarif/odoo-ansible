# ============================
# Nginx HTTP (temporary) config
# Used before SSL certificate is created
# ============================

# odoo server
upstream odoo {
  server odoo:8069;
}
upstream odoochat {
  server odoo:8072;
}
map $http_upgrade $connection_upgrade {
  default upgrade;
  ''      close;
}

# HTTP server for certbot challenge + redirect
server {
  listen 80;
  server_name {{ domain_name }};

  # Allow Certbot to verify domain ownership
  location /.well-known/acme-challenge/ {
    root /var/www/html;
  }

  # Redirect all HTTP traffic to HTTPS (this will work after SSL is ready)
  location / {
    return 301 https://$host$request_uri;
  }
}
